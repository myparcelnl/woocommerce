name: 'Test frontend'
description: 'Run frontend tests'

runs:
  using: composite
  steps:
    - name: 'Run tests'
      shell: bash
      run: |
        yarn nx run-many \
          --output-style=static \
          --runner=cloud \
          --parallel=1 \
          --target=test:coverage

    - name: 'Move coverage files'
      shell: bash
      run: |
        yarn workspaces foreach -pv --exclude '@myparcel/woocommerce' exec \
          bash -c 'if [ -f coverage/clover.xml ]; then mv coverage/clover.xml coverage/$(basename $(pwd)).xml; fi'

    - uses: codecov/codecov-action@v3
      with:
        flags: unit,frontend,admin
        files: views/backend/**/coverage/*.xml

    - uses: codecov/codecov-action@v3
      with:
        flags: unit,frontend,checkout
        files: views/frontend/**/coverage/*.xml
